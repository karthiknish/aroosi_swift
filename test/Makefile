# Aroosi iOS Test Suite Makefile

.PHONY: test test-unit test-integration test-ui test-coverage test-clean test-help

# Default target
test: test-unit test-integration

# Run all unit tests
test-unit:
	@echo "ğŸ§ª Running Unit Tests..."
	cd .. && swift test --filter AroosiAppTests.AuthenticationTests
	cd .. && swift test --filter AroosiAppTests.DashboardTests
	cd .. && swift test --filter AroosiAppTests.ChatTests
	@echo "âœ… Unit Tests Complete"

# Run integration tests
test-integration:
	@echo "ğŸ”— Running Integration Tests..."
	cd .. && swift test --filter AroosiAppTests.FirebaseIntegrationTests
	@echo "âœ… Integration Tests Complete"

# Run UI tests (requires simulator)
test-ui:
	@echo "ğŸ“± Running UI Tests..."
	xcodebuild test \
		-project ../native_ios/AroosiApp.xcodeproj \
		-scheme AroosiApp \
		-destination 'platform=iOS Simulator,name=iPhone 15,OS=17.0' \
		-only-testing:AroosiAppUITests
	@echo "âœ… UI Tests Complete"

# Run tests with coverage
test-coverage:
	@echo "ğŸ“Š Running Tests with Coverage..."
	cd .. && swift test --enable-code-coverage
	@echo "ğŸ“ˆ Generating Coverage Report..."
	cd .. && xcrun llvm-cov report \
		.build/debug/AroosiAppTests.xctest/Contents/MacOS/AroosiAppTests \
		-instr-profile=.build/debug/codecov/default.profdata \
		-sources
	@echo "âœ… Coverage Report Complete"

# Run performance tests
test-performance:
	@echo "âš¡ Running Performance Tests..."
	cd .. && swift test --filter PerformanceTests
	@echo "âœ… Performance Tests Complete"

# Run accessibility tests
test-accessibility:
	@echo "â™¿ Running Accessibility Tests..."
	cd .. && swift test --filter AccessibilityTests
	@echo "âœ… Accessibility Tests Complete"

# Run tests in parallel
test-parallel:
	@echo "ğŸš€ Running Tests in Parallel..."
	cd .. && swift test --parallel
	@echo "âœ… Parallel Tests Complete"

# Run tests with verbose output
test-verbose:
	@echo "ğŸ” Running Tests with Verbose Output..."
	cd .. && swift test --verbose
	@echo "âœ… Verbose Tests Complete"

# Run tests on specific simulator
test-simulator:
	@echo "ğŸ“± Running Tests on iPhone 15 Simulator..."
	xcodebuild test \
		-project ../native_ios/AroosiApp.xcodeproj \
		-scheme AroosiApp \
		-destination 'platform=iOS Simulator,name=iPhone 15,OS=17.0'
	@echo "âœ… Simulator Tests Complete"

# Run tests on multiple simulators
test-multiple-simulators:
	@echo "ğŸ“± Running Tests on Multiple Simulators..."
	xcodebuild test \
		-project ../native_ios/AroosiApp.xcodeproj \
		-scheme AroosiApp \
		-destination 'platform=iOS Simulator,name=iPhone 15,OS=17.0' \
		-destination 'platform=iOS Simulator,name=iPhone 15 Pro,OS=17.0' \
		-destination 'platform=iOS Simulator,name=iPhone 15 Pro Max,OS=17.0'
	@echo "âœ… Multiple Simulator Tests Complete"

# Clean test artifacts
test-clean:
	@echo "ğŸ§¹ Cleaning Test Artifacts..."
	cd .. && swift package clean
	rm -rf ../native_ios/.build
	rm -rf ../native_ios/DerivedData
	rm -rf *.xcresult
	@echo "âœ… Clean Complete"

# Generate test report
test-report:
	@echo "ğŸ“Š Generating Test Report..."
	cd .. && swift test --enable-code-coverage > test-results.txt
	@echo "ğŸ“‹ Test Report Generated: test-results.txt"

# Watch mode for continuous testing
test-watch:
	@echo "ğŸ‘€ Starting Watch Mode..."
	cd .. && fswatch -o . | xargs -n1 -I{} swift test

# Quick test (unit only, no coverage)
test-quick:
	@echo "âš¡ Running Quick Tests..."
	cd .. && swift test --skip-build
	@echo "âœ… Quick Tests Complete"

# Test specific target
test-auth:
	@echo "ğŸ” Testing Authentication..."
	cd .. && swift test --filter AuthenticationTests
	@echo "âœ… Auth Tests Complete"

test-dashboard:
	@echo "ğŸ“Š Testing Dashboard..."
	cd .. && swift test --filter DashboardTests
	@echo "âœ… Dashboard Tests Complete"

test-chat:
	@echo "ğŸ’¬ Testing Chat..."
	cd .. && swift test --filter ChatTests
	@echo "âœ… Chat Tests Complete"

# Firebase-specific tests
test-firebase:
	@echo "ğŸ”¥ Testing Firebase Integration..."
	cd .. && swift test --filter FirebaseIntegrationTests
	@echo "âœ… Firebase Tests Complete"

# Help target
test-help:
	@echo "ğŸ“š Aroosi iOS Test Suite Help"
	@echo ""
	@echo "Available targets:"
	@echo "  test              - Run all unit and integration tests"
	@echo "  test-unit         - Run unit tests only"
	@echo "  test-integration  - Run integration tests only"
	@echo "  test-ui           - Run UI tests (requires simulator)"
	@echo "  test-coverage     - Run tests with coverage report"
	@echo "  test-performance  - Run performance tests"
	@echo "  test-accessibility- Run accessibility tests"
	@echo "  test-parallel     - Run tests in parallel"
	@echo "  test-verbose      - Run tests with verbose output"
	@echo "  test-simulator    - Run tests on specific simulator"
	@echo "  test-multiple-simulators - Run tests on multiple simulators"
	@echo "  test-clean        - Clean test artifacts"
	@echo "  test-report       - Generate test report"
	@echo "  test-watch        - Watch mode for continuous testing"
	@echo "  test-quick        - Quick tests (no build, no coverage)"
	@echo "  test-auth         - Test authentication module"
	@echo "  test-dashboard    - Test dashboard module"
	@echo "  test-chat         - Test chat module"
	@echo "  test-firebase     - Test Firebase integration"
	@echo "  test-help         - Show this help message"
	@echo ""
	@echo "Examples:"
	@echo "  make test-coverage"
	@echo "  make test-auth"
	@echo "  make test-clean && make test-coverage"
